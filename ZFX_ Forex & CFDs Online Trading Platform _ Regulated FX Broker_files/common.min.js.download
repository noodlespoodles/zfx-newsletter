!function(t){"use strict";depp.define({"zw-chart-js":[zwidgets.url+"assets/public/js/Chart.min.js"],"zw-echarts":[zwidgets.url+"assets/public/js/echarts-en.min.js"],"zw-tinycolor":[zwidgets.url+"assets/public/js/tinycolor.min.js"],"zw-rangeslider":[zwidgets.url+"assets/public/js/rangeslider.min.js"],"zw-datatable":[zwidgets.url+"assets/public/js/jquery.dataTables.min.js"],"zw-datatable-responsive":[zwidgets.url+"assets/public/js/dataTables.responsive.min.js?v=1"],"zw-dragscroll":[zwidgets.url+"assets/public/js/dragscroll.js"],"zw-typeahead":[zwidgets.url+"assets/public/js/typeahead.bundle.min.js"]}),zwidgets.addCommas=function(t,e,a){for(var i=(t+="").split("."),o=i[0],s=i.length>1?e+i[1]:"",r=/(\d+)(\d{3})/;r.test(o);)o=o.replace(r,"$1"+a+"$2");return isNaN(t)?"":o+s},zwidgets.numberFormat=function(t,e,a=!1,i="auto"){t=parseFloat(t);var o=void 0!==mstocks.currency_format[e]?mstocks.currency_format[e]:mstocks.default_currency_format;i=a?o.decimals:"auto"==i?t>=1?o.decimals:t<1e-6?14:6:parseInt(i),t=t.toFixed(i);var s=0,r="",n=mstocks.suffixes.hasOwnProperty(e)?mstocks.suffixes[e]:mstocks.suffixes.USD;if(a){for(;t>1e3;)t/=1e3,s++;r=n[s]}return mstocks.number_format(t,i,o.decimals_sep,o.thousands_sep)+r},zwidgets.priceFormat=function(t,e){t=parseFloat(t);var a=void 0!==zwidgets.currency_format[e]?zwidgets.currency_format[e]:zwidgets.default_currency_format,i=t>=1?a.decimals:4,o=a.position;return o=(o=(o=o.replace("{symbol}",a.symbol)).replace("{space}"," ")).replace("{price}",zwidgets.addCommas(t.toFixed(i),a.decimals_sep,a.thousands_sep))},zwidgets.addDecimals=function(t,e){return t=parseFloat(t)};var e=[];t.fn.multiply=function(t){for(var e=this.clone(),a=1;a<t;a++)e=e.add(this.clone());return e},t.fn.zwDrawChart=function(){var e=t(this);depp.require("zw-chart-js",(function(){var a=e.find("canvas"),i=e.data("currency"),o=a.data("border"),s=a.data("colors").split("|"),r=a.data("points").toString().split(","),n=a.data("tooltip-theme"),c=!!(a.data("labels")&&a.data("labels").split(",").length>0),l=s[0]?s[0]:"#4C84FE",d="rgba(255,255,255,0)";if(s[1]&&s[2]){var h=parseInt(a.attr("height"))+5;(d=a[0].getContext("2d").createLinearGradient(0,0,0,h)).addColorStop(0,s[1]),d.addColorStop(1,s[2])}else s[1]&&(d=s[1]?s[1]:s[0]);var p={labels:c?a.data("labels").split("|"):r,datasets:[{data:r,fill:!!s[1],backgroundColor:d,borderColor:l,pointRadius:0,borderWidth:o,pointHitRadius:50,pointHoverBorderColor:"white",pointHoverBackgroundColor:l,pointHoverBorderWidth:3,pointHoverRadius:6}]},u={animation:{duration:500},legend:{display:!1},scales:{xAxes:[{display:!1}],yAxes:[{display:!1}]},tooltips:{enabled:!1,intersect:!0,callbacks:{title:function(t,e){return!!c&&t[0].label},label:function(t,e){return zwidgets.priceFormat(t.value,i)}},custom:function(e){var a=t(this._chart.canvas).data("tooltip-theme"),i=t(".chartjs-tooltip-"+a)[0];if(0!==e.opacity){if(i.classList.remove("above","below","no-transform"),e.yAlign?i.classList.add(e.yAlign):i.classList.add("no-transform"),e.body){var o=e.title||[],r=e.body.map((function(t){return t.lines})),n="<thead>";o.forEach((function(t){n+="<tr><th>"+t+"</th></tr>"})),n+="</thead><tbody>",r.forEach((function(t,e){var a=s[2]?s[2]:s[1]?s[1]:s[0];n+="<tr><td>"+('<span class="chartjs-tooltip-key" style="'+("background:"+(""!=a?a:"#4C84FE"))+'"></span>')+t+"</td></tr>"})),n+="</tbody>",i.querySelector("table").innerHTML=n}var c=t(this._chart.canvas).offset().top-t(window).scrollTop(),l=t(this._chart.canvas).offset().left;i.style.opacity=1,i.style.left=l+e.caretX+"px",i.style.top=c+e.caretY+"px"}else i.style.opacity=0}},hover:{mode:"nearest",intersect:!0},maintainAspectRatio:!1,layout:{padding:{top:1,bottom:1}}};0==t(".chartjs-tooltip-"+n).length&&t("body").append('<div class="chartjs-tooltip chartjs-tooltip-'+n+'"><table></table></div>');new Chart(a[0].getContext("2d"),{type:"line",data:p,options:u})}))},t(".zw-ticker-vertical").on("view",(function(){var a=t(this),i=a.closest(".zw-box").attr("id"),o=a.find(".cc-ticker"),s=0,r=0,n=a.width();0==a.hasClass("zw-ticker-init")?(a.find(".cc-stock").each((function(){s+=t(this).outerWidth()})),r=a.find(".cc-stock").length):(s=e[i].w,r=e[i].l);var c=s/r,l=Math.max(Math.floor(n/c),1);0==a.hasClass("zw-ticker-init")&&(e[i]=[],e[i].d=a.find(".zw-ticker-stats").clone(),e[i].h=a.find(".zw-ticker-stats").height(),e[i].l=r,e[i].w=s,o.css("height",a.find(".zw-ticker-stats").height()),o.empty().html('<div class="zw-ticker-stats"></div><div class="zw-ticker-stats"></div>'),a.addClass("zw-ticker-init"));var d=1,h=e[i].d.find("> a").length>0?"a":"div",p=e[i].d.find("> "+h).length,u=p%l!=0?p*l:p;clearInterval(e[i].i);var w=function(){for(var s="",r=d;r<d+l;r++){var n=r%p==0?p:r%p;s+=e[i].d.find("> "+h+":nth-child("+n+")")[0].outerHTML}o.find(".zw-ticker-stats:last").empty().html(s),a.find(".zw-inline-chart").each((function(){t(this).zwDrawChart()})),o.stop().animate({scrollTop:e[i].h},400,"swing",(function(){t(this).scrollTop(0).find(".zw-ticker-stats:last").after(t(".zw-ticker-stats:first",this))})),d=d-1==u-l?1:d+l};w();var f=a.data("speed"),m=2;200===f?m=0:f>100?m-=f=(f-=100)/100*l:f<100&&(m+=f=(f=100-f)/10*l),0!==f&&(e[i].i=setInterval(w,1e3*m)),a.css("visibility","visible"),a.hasClass("zw-header")&&(t("body").css("padding-top",e[i].h+"px"),t("#wpadminbar").css("margin-top",e[i].h+"px"))})),t(".zw-ticker-horizontal").on("view",(function(){var e=t(this),a=t(this).find(".zw-ticker-stats"),i=0;a.find(".cc-stock").each((function(){i+=t(this).innerWidth()}));var o=a.find(".cc-stock"),s=a.innerWidth()/i;a.append('<div class="cc-dup"></div>'),s>.5?a.find(".cc-dup").append(o.multiply(Math.ceil(s))):a.find(".cc-dup").append(o.multiply(1)),a.css("width",i),a.find(".zw-inline-chart").each((function(){t(this).zwDrawChart()}));var r=a.find(".cc-stock").length,n=i/r,c=10*n;200===(l=t(this).closest(".zw-ticker").data("speed"))?c=10:0==l?c=0:l>100?c-=l=(l-=100)/10*n:l<100&&(c+=l=(l=100-l)/10*(8*n));var l=r*c/1e3;a.css("animation-duration",l+"s"),e.css("visibility","visible"),e.hasClass("zw-header")&&(t("body").css("padding-top",e.height()+"px"),t("#wpadminbar").css("margin-top",e.height()+"px"))})),t(window).on("load",(function(){t(".zw-ticker").each((function(){t(this).trigger("view")}))}));var a,i,o,s,r=(a=function(){t(".zw-ticker-vertical").each((function(){t(this).trigger("view")}))},i=500,function(){var t=this,e=arguments;clearTimeout(s),s=setTimeout((function(){s=null,o||a.apply(t,e)}),i),o&&!s&&a.apply(t,e)});window.addEventListener("resize",r),t.fn.zwChart=function(){if(0!==this.length){var e=t(this);depp.require(["zw-echarts","zw-tinycolor"],(function(){var a=360,i=["1d","5d","1mo","6mo","1y","5y"],o=e.data("opts"),s={light:{textColor:""==(o=t.extend({id:"AAPL",symbol:"AAPL",name:"Apple, Inc.",currency:"USD",type:"line",theme:"light",period:"1d",toolbox:!0,gradient:!0},o)).textcolor?"#222":o.textcolor,backgroundColor:""==o.bgcolor?"#fff":o.bgcolor,tooltipColor:"#3A414F",chartColor:""==o.chartcolors[0]?"#5274D6":o.chartcolors[0],chartColors:["rgba(108,130,145,0.2)","#14b143","#ef232a"]},dark:{textColor:""==o.textcolor?"#f2f2f2":o.textcolor,backgroundColor:""==o.bgcolor?"#202328":o.bgcolor,tooltipColor:"#3A414F",chartColor:""==o.chartcolors[0]?"#5274D6":o.chartcolors[0],chartColors:["rgba(108,130,145,0.2)","#14b143","#ef232a"]}}[o.theme],r=function(){var t={color:s.chartColors,backgroundColor:s.backgroundColor,textStyle:{color:s.textColor,fontFamily:"inherit"==o.font?e.css("font-family"):o.font},title:{text:o.symbol,subtext:o.name,textStyle:{color:s.textColor},padding:15},tooltip:{trigger:"axis",confine:!0,backgroundColor:s.tooltipColor,formatter:function(t){var e=t[0].name;return"line"==o.type?(e+="<br/>",e+=t[0].marker+zwidgets.priceFormat(t[0].value,o.currency)):(e+="<br/>",e+=t[0].marker+"open: "+zwidgets.priceFormat(t[0].value[1],o.currency)+"<br/>",e+=t[0].marker+"close: "+zwidgets.priceFormat(t[0].value[2],o.currency)+"<br/>",e+=t[0].marker+"high: "+zwidgets.priceFormat(t[0].value[4],o.currency)+"<br/>",e+=t[0].marker+"low: "+zwidgets.priceFormat(t[0].value[3],o.currency)+"<br/>",e+=t[1].marker+"volume: "+zwidgets.priceFormat(t[1].value,o.currency)),e}},legend:{show:!1},grid:{left:15,right:15,top:o.toolbox&&e.width()<a?110:80,bottom:20,containLabel:!0},xAxis:[],yAxis:[],series:[],dataZoom:[]};return o.toolbox&&(t.toolbox={show:!0,top:e.width()>a?10:60,left:e.width()>a?"auto":10,right:e.width()>a?10:"auto",itemSize:40,showTitle:!1,feature:{myTool1:{show:!0,icon:"image://"+zwidgets.url+"assets/public/img/chart/1d-"+o.theme+".svg",iconStyle:{opacity:.3},onclick:function(){l("1d")}},myTool2:{show:!0,icon:"image://"+zwidgets.url+"assets/public/img/chart/5d-"+o.theme+".svg",iconStyle:{opacity:.3},onclick:function(){l("5d")}},myTool3:{show:!0,icon:"image://"+zwidgets.url+"assets/public/img/chart/1mo-"+o.theme+".svg",iconStyle:{opacity:.3},onclick:function(){l("1mo")}},myTool4:{show:!0,icon:"image://"+zwidgets.url+"assets/public/img/chart/6mo-"+o.theme+".svg",iconStyle:{opacity:.3},onclick:function(){l("6mo")}},myTool5:{show:!0,icon:"image://"+zwidgets.url+"assets/public/img/chart/1y-"+o.theme+".svg",iconStyle:{opacity:.3},onclick:function(){l("1y")}},myTool6:{show:!0,icon:"image://"+zwidgets.url+"assets/public/img/chart/5y-"+o.theme+".svg",iconStyle:{opacity:.3},onclick:function(){l("5y")}}},iconStyle:{opacity:.3},emphasis:{iconStyle:{opacity:1}}},t.toolbox.feature["myTool"+(i.indexOf(o.period)+1)].iconStyle={opacity:1}),"line"==o.type&&(t.xAxis.push({type:"category",boundaryGap:!1,axisLabel:{showMinLabel:!1,showMaxLabel:!1}}),t.yAxis.push({type:"value",scale:!0,position:"right",splitLine:{show:!0,lineStyle:{color:"rgba(0,0,0,0.1)",width:1,type:"solid"}},axisLabel:{formatter:function(t,e){return 0==t?0:zwidgets.numberFormat(t,o.currency)}}}),t.series.push({type:"line",smooth:!0,symbol:"none",lineStyle:{width:2},itemStyle:{color:s.chartColor},areaStyle:o.chartcolors[1]&&o.chartcolors[2]?{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:o.chartcolors[1]},{offset:1,color:o.chartcolors[2]}]},opacity:1}:{color:o.chartcolors[1]?o.chartcolors[1]:o.chartcolors[0],opacity:o.chartcolors[1]?1:0}})),"candlestick"==o.type&&(t.xAxis.push({type:"category",boundaryGap:!0,axisLabel:{showMinLabel:!1,showMaxLabel:!1}}),t.yAxis.push({type:"value",scale:!1,position:"right",min:"dataMin",max:"dataMax",splitLine:{show:!1},axisLabel:{showMinLabel:!1,formatter:function(t,e){return 0===t?0:zwidgets.numberFormat(t,o.currency)}}},{type:"value",scale:!1,splitLine:{show:!0,lineStyle:{color:"rgba(0,0,0,0.1)",width:1,type:"solid"}},axisLabel:{show:!1},axisTick:{show:!1},axisLine:{show:!1}}),t.series.push({name:"OHLC",type:"candlestick",itemStyle:{normal:{color:s.chartColors[1],color0:s.chartColors[2],borderColor:s.chartColors[1],borderColor0:s.chartColors[2]}}}),t.series.push({name:"Volume",type:"bar",yAxisIndex:1}),t.dataZoom.push({type:"inside",xAxisIndex:[0]})),t},n=echarts.init(e[0]);function c(){var e;n.showLoading("default",{text:"",maskColor:s.backgroundColor}),e=function(t){var e=t.filter((function(t){return"line"==o.type?t.close:t.close&&t.open})),a=r();a.xAxis[0].data=[],a.series[0].data=[],"candlestick"==o.type&&(a.series[1].data=[]);for(var i=0;i<e.length;i++){var s="label"in e[i]?e[i].label:e[i].date,c=zwidgets.addDecimals(e[i].open,o.currency),l=zwidgets.addDecimals(e[i].close,o.currency),d=zwidgets.addDecimals(e[i].high,o.currency),h=zwidgets.addDecimals(e[i].low,o.currency);"line"==o.type&&(a.xAxis[0].data.push(s),a.series[0].data.push(l)),"candlestick"==o.type&&(a.xAxis[0].data.push(s),a.series[0].data.push([c,l,h,d]),a.series[1].data.push(e[i].volume))}n.setOption(a),n.hideLoading()},t.get(zwidgets.ajaxurl,{action:"zw_chart",symbols:o.id,period:o.period,currency:o.currency,chartCloseOnly:"candlestick"==o.type?"false":"true"},(function(t){return e(t[o.id]["chart-"+o.period].points)}),"json")}function l(t){o.period=t,c()}t(window).on("resize",(function(){var t=r();n.setOption(t),n.resize()})),c()}))}},t.fn.zwAccordion=function(){this.find(".zw-list-item:eq(0)").addClass("active").find(".zw-list-body").slideDown(),this.find(".zw-list-header").on("click",(function(){t(this).parents(".zw-list").find(".zw-list-item").not(t(this).parent()).removeClass("active").find(".zw-list-body").slideUp(),t(this).parent().toggleClass("active"),t(this).next(".zw-list-body").slideToggle()}))},t.fn.zwTable=function(){var e=t("html").attr("lang"),a="en"!==e&&"en-MY"!==e&&"en-ae"!==e&&e?e:"en",i=this.find(".zw-datatable"),o=i.data("config"),s=i.find("tbody tr").length,r=t(".zw-box .preloader"),n=["zw-datatable"];o.responsive?n.push("zw-datatable-responsive"):n.push("zw-dragscroll"),depp.require(n,(function(){var e=[];i.find("thead th").each((function(a){var i=t(this).data("col");e.push({name:i})}));var n={dom:'<"datatable-header"f><"loader"><"datatable-scroll dragscroll"t><"datatable-footer"ip><"loader loader-footer"><"clear">',ordering:!1,columns:e,pageLength:10,columnDefs:[{targets:"col-"+e[0].data,className:"ctrl all"},{targets:"col-52_week_range",width:"100px","max-width":"100px"},{targets:"col-chart-1d",width:"100px","max-width":"100px"},{targets:"col-chart-5d",width:"100px","max-width":"100px"}],language:{url:`/wp-content/plugins/zfx-widgets/languages/${a}.json`,processing:"",emptyTable:'<div style="text-align: left;">No stocks found.</div>',searchPlaceholder:"Search:",paginate:{first:"First",last:"Last",next:"Next",previous:"Previous"}},searching:!0,paging:s>10,responsive:o.responsive,drawCallback:function(){!function(t){const e=new CustomEvent("tableChange",{detail:t});window.dispatchEvent(e)}({message:!0}),i.find(".zw-inline-chart").each((function(){t(this).zwDrawChart()})),i.find(".zw-range-slider").each((function(){t(this).zwRangeSlider()}))},initComplete:function(){o.responsive||(i.find(".datatable-scroll").attr("nochilddrag","true").addClass("dragscroll"),dragscroll.reset()),r.hide(),t(".zw-table").show(),t(".zw-inline-chart").each((function(){t(this).zwDrawChart()}))}};window.addEventListener("tableResize",(function(e){t(".zw-table thead th").each((function(){const e=t(this);e.removeClass("hidden-column-prev");const a=e.prev();"none"===e.css("display")?a.addClass("hidden-column-prev"):a.removeClass("hidden-column-prev")}))})),i.DataTable(n).on("responsive-display",(function(e){t(e.currentTarget).find("td.child .zw-inline-chart").each((function(){t(this).zwDrawChart()})),t(e.currentTarget).find(".zw-range-slider").each((function(){t(this).zwRangeSlider()}))}))}))},t.fn.zwRangeSlider=function(){var e=t(this),a=e.data("currency");depp.require("zw-rangeslider",(function(){var i=e.find("input"),o=["#f00","orange","#06a076"],s=i.val(),r=i.attr("min"),n=i.attr("max");i.rangeslider({polyfill:!1,onInit:function(){var e=100*(s-r)/(n-r),i=e>66?o[2]:e>33?o[1]:o[0];t(this.$handle).html(zwidgets.priceFormat(s,a)),t(this.$fill).css("background",i),t(this.$handle).css("background",i),t(this.$range).append('<div class="range-min">'+zwidgets.priceFormat(r,a)+'</div><div class="range-max">'+zwidgets.priceFormat(n,a)+"</div>")}}),i.rangeslider("update",!0)}))},t.fn.zwResize=function(){var t="zw-xs zw-sm zw-md zw-lg zw-xl",e=this.width();e>=1200?t="zw-xl":e>=992?t="zw-lg zw-xl":e>=768?t="zw-md zw-lg zw-xl":e>=576&&(t="zw-sm zw-md zw-lg zw-xl"),this.removeClass("zw-xs zw-sm zw-md zw-lg zw-xl").addClass(t).attr("data-width",e),this.removeClass("zw-hidden")},t.fn.zwSearch=function(){var e=this,a=e.find("input");depp.require(["zw-typeahead"],(function(){e.find("input").typeahead({hint:!0,highlight:!0,minLength:1},{name:"stocks",display:function(t){return t.name},source:new Bloodhound({datumTokenizer:Bloodhound.tokenizers.obj.whitespace("name"),queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:zwidgets.ajaxurl+"?action=zw_search_stocks&id="+e.attr("id").split("-")[1]+"&query=%QUERY",wildcard:"%QUERY",prepare:function(a,i){return t(".zw-search .search-icon").addClass("search-load"),i.url=zwidgets.ajaxurl+"?action=zw_search_stocks&id="+e.attr("id").split("-")[1]+"&query="+a,i},filter:function(e){return t(".zw-search .search-icon").removeClass("search-load"),e.data}}}),templates:{suggestion:function(t){var e="";return e+="<p>",e+=t.link?'<a href="'+t.link+'" class="prelink">':'<span class="prelink">',e+='<b class="stocksymbol">'+t.symbol+"</b>",e+='<span class="stockname">'+t.name+"</span>",e+="<small>"+t.type+" - "+t.exchange+"</small>",e+=t.link?"</a>":"</span>",e+="</p>"}}}),a.on("typeahead:open input",(function(){e.find(".tt-dataset p").length>0?a.addClass("dropdown-open"):a.removeClass("dropdown-open")})),a.on("typeahead:close",(function(){a.removeClass("dropdown-open")})),a.on("keypress",(function(t){if(13==t.which){var a=e.find(".tt-suggestion:first-child a").attr("href");void 0!==a&&(window.location=a)}}))}))},t(".zw-box").each((function(){t(this).zwResize()})),t(window).resize((function(){t(".zw-box").each((function(){t(this).zwResize()}))})),t(".zw-list-toggle").each((function(){t(this).zwAccordion()})),t(".zw-chart").each((function(){t(this).zwChart()})),t(".zw-table").each((function(){t(this).zwTable()})),0===t(".zw-datatable").length&&t(".zw-inline-chart").each((function(){t(this).zwDrawChart()})),t(".zw-search").each((function(){t(this).zwSearch()}))}(jQuery);
